import{R as g,u as m,a as u,j as a,s as y,r as h,b as v,c as P,d as M,V as x,e as E,f as b,g as z}from"./index-CtxJ6y1F.js";var C={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},O=g.createContext&&g.createContext(C),k=["attr","size","title"];function D(e,t){if(e==null)return{};var s=I(e,t),n,i;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(i=0;i<d.length;i++)n=d[i],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}function I(e,t){if(e==null)return{};var s={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;s[n]=e[n]}return s}function j(){return j=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n])}return e},j.apply(this,arguments)}function S(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),s.push.apply(s,n)}return s}function w(e){for(var t=1;t<arguments.length;t++){var s=arguments[t]!=null?arguments[t]:{};t%2?S(Object(s),!0).forEach(function(n){A(e,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):S(Object(s)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(s,n))})}return e}function A(e,t,s){return t=L(t),t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function L(e){var t=$(e,"string");return typeof t=="symbol"?t:t+""}function $(e,t){if(typeof e!="object"||!e)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var n=s.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _(e){return e&&e.map((t,s)=>g.createElement(t.tag,w({key:s},t.attr),_(t.child)))}function N(e){return t=>g.createElement(T,j({attr:w({},e.attr)},t),_(e.child))}function T(e){var t=s=>{var{attr:n,size:i,title:d}=e,c=D(e,k),o=i||s.size||"1em",l;return s.className&&(l=s.className),e.className&&(l=(l?l+" ":"")+e.className),g.createElement("svg",j({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,n,c,{className:l,style:w(w({color:e.color||s.color},s.style),e.style),height:o,width:o,xmlns:"http://www.w3.org/2000/svg"}),d&&g.createElement("title",null,d),e.children)};return O!==void 0?g.createElement(O.Consumer,null,s=>t(s)):t(C)}function B(e){return N({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M19.023 16.977a35.13 35.13 0 0 1-1.367-1.384c-.372-.378-.596-.653-.596-.653l-2.8-1.337A6.962 6.962 0 0 0 16 9c0-3.859-3.14-7-7-7S2 5.141 2 9s3.14 7 7 7c1.763 0 3.37-.66 4.603-1.739l1.337 2.8s.275.224.653.596c.387.363.896.854 1.384 1.367l1.358 1.392.604.646 2.121-2.121-.646-.604c-.379-.372-.885-.866-1.391-1.36zM9 14c-2.757 0-5-2.243-5-5s2.243-5 5-5 5 2.243 5 5-2.243 5-5 5z"},child:[]}]})(e)}const R=({user:e})=>{const t=m(),{selectedUser:s}=u(d=>d.users),{onlineUsers:n}=u(d=>d.users),i=()=>{t(y(e))};return a.jsxs("div",{children:[a.jsxs("div",{onClick:i,className:`${(s==null?void 0:s._id)===(e==null?void 0:e._id)?"bg-zinc-200 text-black":"text-white"}  flex gap-2 items-center  hover:bg-zinc-200 hover:text-black p-2 rounded-sm cursor-pointer`,children:[a.jsx("div",{className:`avatar ${n.includes(e==null?void 0:e._id)?"avatar-online":"avatar-ofline"}`,children:a.jsx("div",{className:"w-16 rounded-full",children:a.jsx("img",{src:e==null?void 0:e.profilePic,alt:"user-profile"})})}),a.jsx("div",{className:"  font-bold text-xl",children:e==null?void 0:e.userName})]}),a.jsx("div",{className:"divider my-0 py-0 font-black h-1"})]})},G=({searchUser:e})=>(e==null?void 0:e.length)==0?a.jsx("div",{className:"font-bold w-full my-28 text-center ",children:"No User Found Of This Name"}):a.jsx("div",{className:"  text-white flex-1 ",children:e==null?void 0:e.map(t=>a.jsx(R,{user:t},t._id))}),W=()=>{const e=m();h.useEffect(()=>{(async()=>{var s;try{const n=await v.get("http://localhost:8080/api/v1/user/otherUsers",{withCredentials:!0});e(P((s=n==null?void 0:n.data)==null?void 0:s.users))}catch(n){console.log(n.message)}})()},[])},V=()=>{W();const{otherUsers:e}=u(l=>l.users),[t,s]=h.useState(""),[n,i]=h.useState([]);h.useEffect(()=>{i(e.filter(l=>l.userName.toLowerCase().startsWith(t.toLowerCase())))},[t,e]);const d=M(),c=m(),o=async()=>{var l,f,p;try{const r=await v.get("http://localhost:8080/api/v1/user/logout",{withCredentials:!0});(l=r==null?void 0:r.data)!=null&&l.success?(x.success((f=r==null?void 0:r.data)==null?void 0:f.message),c(E(null)),c(P([])),c(y(null)),c(b([])),c(z([])),d("/login")):x.error((p=r==null?void 0:r.data)==null?void 0:p.message)}catch(r){x.error(r.message)}};return a.jsxs("div",{className:`\r
    \r
        flex flex-col\r
        w-screen        /* Fixed width on desktop */\r
        sm:w-72      /* Slightly narrower on small screens */\r
        flex-shrink-0\r
      `,children:[a.jsx("div",{className:"text-green-500 flex justify-center text-2xl font-bold",children:"Samvada"}),a.jsxs("form",{action:"",className:"flex mt-2 items-center gap-2",children:[a.jsx("input",{value:t,onChange:l=>{var f;s((f=l==null?void 0:l.target)==null?void 0:f.value)},type:"text",className:`\r
            input input-bordered\r
            w-full\r
            rounded-md\r
          `,placeholder:"Search..."}),a.jsx("button",{type:"submit",className:`\r
            btn bg-zinc-600 text-white\r
            min-w-10\r
            px-3\r
            py-2\r
            md:px-4\r
          `,children:a.jsx(B,{className:"w-5 h-5 md:w-6 md:h-6"})})]}),a.jsx("div",{className:"divider px-3 my-5"}),a.jsx("div",{className:"",children:a.jsx(G,{searchUser:n})}),a.jsx("div",{className:"mt-2 flex  justify-center",children:a.jsx("button",{className:"btn mb-2 btn-sm w-full md:w-auto hover:bg-blue-600 hover:text-white",onClick:o,children:"Logout"})})]})},F=({m:e})=>{const{user:t}=u(o=>o.users),{selectedUser:s}=u(o=>o.users),n=h.useRef();h.useEffect(()=>{var o;(o=n.current)==null||o.scrollIntoView({behavior:"smooth"})},[e]);const i=new Date(e==null?void 0:e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),c=new Date(e.createdAt).toLocaleDateString([],{day:"numeric",month:"long"});return a.jsx("div",{ref:n,className:"",children:a.jsxs("div",{className:`chat ${(e==null?void 0:e.senderId)===(t==null?void 0:t._id)?"chat-end":"chat-start"}`,children:[a.jsx("div",{className:"chat-image avatar",children:a.jsx("div",{className:"w-10 rounded-full",children:a.jsx("img",{alt:"Tailwind CSS chat bubble component",src:(e==null?void 0:e.senderId)===(t==null?void 0:t._id)?t==null?void 0:t.profilePic:s==null?void 0:s.profilePic})})}),a.jsx("div",{className:"chat-header",children:a.jsx("time",{className:"text-xs opacity-50 text-white hover:bg-black text-xl",children:`${c}  ${i}`})}),a.jsx("div",{className:`chat-bubble ${(e==null?void 0:e.senderId)===(t==null?void 0:t._id)?"bg-green-300":"bg-white"}`,children:e==null?void 0:e.message})]})})},H=()=>{const{selectedUser:e}=u(s=>s.users),t=m();h.useEffect(()=>{(async()=>{try{v.defaults.withCredentials=!0;const n=await v.post(`http://localhost:8080/api/v1/message/getMessages/${e==null?void 0:e._id}`);t(b(n==null?void 0:n.data))}catch(n){console.log(n==null?void 0:n.message)}})()},[e==null?void 0:e._id])},U=()=>{const{socket:e}=u(n=>n.sockets),{messages:t}=u(n=>n.Messages),s=m();h.useEffect(()=>(e==null||e.on("newMessage",n=>{s(b([...t,n]))}),()=>e==null?void 0:e.off("newMessage")),[b,t])},K=()=>{H(),U();const{messages:e}=u(t=>t.Messages);if(e)return a.jsx("div",{className:"px-4 flex-1  text-white",children:e.map(t=>a.jsx(F,{m:t},t._id))})};function Z(e){return N({attr:{viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{d:"M7.712 4.818A1.5 1.5 0 0 1 10 6.095v2.972c.104-.13.234-.248.389-.343l6.323-3.906A1.5 1.5 0 0 1 19 6.095v7.81a1.5 1.5 0 0 1-2.288 1.276l-6.323-3.905a1.505 1.505 0 0 1-.389-.344v2.973a1.5 1.5 0 0 1-2.288 1.276l-6.323-3.905a1.5 1.5 0 0 1 0-2.552l6.323-3.906Z"},child:[]}]})(e)}function q(e){return N({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"m476.59 227.05-.16-.07L49.35 49.84A23.56 23.56 0 0 0 27.14 52 24.65 24.65 0 0 0 16 72.59v113.29a24 24 0 0 0 19.52 23.57l232.93 43.07a4 4 0 0 1 0 7.86L35.53 303.45A24 24 0 0 0 16 327v113.31A23.57 23.57 0 0 0 26.59 460a23.94 23.94 0 0 0 13.22 4 24.55 24.55 0 0 0 9.52-1.93L476.4 285.94l.19-.09a32 32 0 0 0 0-58.8z"},child:[]}]})(e)}const J=()=>{const[e,t]=h.useState(""),{selectedUser:s}=u(c=>c.users),{messages:n}=u(c=>c.Messages),i=m(),d=async c=>{var o,l,f,p;c.preventDefault();try{const r=await v.post(`http://localhost:8080/api/v1/message/sendMessage/${s._id}`,{message:e},{headers:{"Content-Type":"application/json"},withCredentials:!0});(o=r==null?void 0:r.data)!=null&&o.status?(x.success((l=r==null?void 0:r.data)==null?void 0:l.message),i(b([...n,(f=r==null?void 0:r.data)==null?void 0:f.newMessage])),t("")):x.error((p=r==null?void 0:r.data)==null?void 0:p.message)}catch(r){x.error(r==null?void 0:r.message)}};return a.jsx("form",{className:"px-4 my-3   ",onSubmit:d,children:a.jsxs("div",{className:"w-full relative",children:[a.jsx("input",{type:"text",value:e,onChange:c=>{var o;return t((o=c==null?void 0:c.target)==null?void 0:o.value)},placeholder:"Send a Message...",className:"border p-3 border-zinc-500 text-sm mb-1 rounded-lg block w-full bg-gray-600 text-white"}),a.jsx("button",{className:"absolute inset-y-0 end-0 pr-4 flex items-center",children:a.jsx(q,{})})]})})},Q=()=>{const e=m(),t=M(),{selectedUser:s}=u(i=>i.users),{onlineUsers:n}=u(i=>i.users);return a.jsxs("div",{className:"w-screen flex-col",children:[a.jsxs("div",{className:"flex gap-2 items-center p-2 rounded-sm cursor-pointer bg-white px-4 py-2 mb-2 ",children:[a.jsx("button",{className:"px-1 cursor-pointer",onClick:()=>{e(y(null)),t("/")},children:a.jsx(Z,{})}),a.jsx("div",{className:`avatar ${n.includes(s._id)?"avatar-online":"avatar-offline"} `,children:a.jsx("div",{className:"w-16 rounded-full",children:a.jsx("img",{src:s==null?void 0:s.profilePic,alt:"user-profile"})})}),a.jsx("div",{className:" text-xl",children:s==null?void 0:s.userName})]}),a.jsx(K,{}),a.jsx(J,{})]})},Y=()=>{const{selectedUser:e}=u(t=>t.users);return a.jsx("div",{className:`\r
        bg-[url(/background.jpg)]\r
        bg-cover bg-center\r
        min-h-screen w-screen\r
        px-2\r
        flex justify-center items-center\r
      `,children:e==null?a.jsx("div",{className:`\r
            w-full max-w-xs\r
            h-[90vh]\r
            flex-1\r
            overflow-auto\r
            flex\r
            rounded-lg \r
            justify-center\r
            bg-clip-padding backdrop-filter backdrop-blur-xs bg-opacity-0\r
          `,children:a.jsx(V,{})}):a.jsx("div",{className:`\r
            w-full max-w-2xl\r
            h-[90vh]\r
            flex-1\r
            overflow-auto\r
            flex\r
            rounded-lg \r
            bg-clip-padding backdrop-filter backdrop-blur-xs bg-opacity-0\r
          `,children:a.jsx(Q,{})})})};export{Y as default};
